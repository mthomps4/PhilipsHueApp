<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Philips Hue Web App</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="main.css">
    <!-- light switch on/off -->
    <!-- <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script> -->
  </head>
  <body>
<div class="container">
  <h1>Philips Hue Web App</h1>
      <p>Added Jquery commands to test how light data worked.
        <br> Will work on creating dynamics in Angular2 MVC</p>
        <br>
        <br>

        <h1>Stand Alone Test</h1>
        <h3>Light 1 Test</h3>
        <!-- <input id="Test1" type="checkbox" checked data-toggle="toggle" data-size="large" data-onstyle="info" data-offstyle="danger"> -->

        <label class="switch">
          <input id="Test1" type="checkbox" checked>
          <div class="slider"></div>
        </label>


        <hr>

        <button id="getData">Return Light State </button>
        <div id="data"></div>
        <hr>

        <input type="button" value="Get Lights" onclick="getLights();" />
        <div id="getLights"></div>
</div>


  <script>
  "use strict";
  //Make sure Light is off on page load
  //Will look to add dynamic 'checks' later
  $('#Test1').removeAttr('checked');
  $.ajax({
       type: "PUT",
       url: "http://192.168.1.107/api/nbEypJkH8KItw3APB3Ci2YIB6t48vW15j6qXBzpm/lights/1/state",
       dataType: 'json',
       contentType: 'application/json',
       data:  JSON.stringify({"on": false}),
       success: function(data, response){
         console.log(response);
         console.log("turning Test1 Off!");
       }
    });

    //Stand Alone Test
    $(document).ready(function() {
        $('#Test1').change(function() {
            if($(this).is(":checked")) {
                $.ajax({
                 type: "PUT",
                 url: "http://192.168.1.107/api/nbEypJkH8KItw3APB3Ci2YIB6t48vW15j6qXBzpm/lights/1/state",
                 dataType: 'json',
                 contentType: 'application/json',
                 data:  JSON.stringify({"on": true}),
                 success: function(data, response){
                   console.log(response);
                   console.log("turning Test1 ON!");
                 }
              });
            }

            else{
              $.ajax({
               type: "PUT",
               url: "http://192.168.1.107/api/nbEypJkH8KItw3APB3Ci2YIB6t48vW15j6qXBzpm/lights/1/state",
               dataType: 'json',
               contentType: 'application/json',
               data:  JSON.stringify({"on": false}),
               success: function(data, response){
                 console.log(response);
                 console.log("turning Test1 Off!");
               }
            });
          }//Else

        });//If button toggled
    });//DocumentReady


//Return Light States
$("#getData").click(function(){
  $("#data").empty();
  $.ajax({
   type: "GET",
   url: "http://192.168.1.107/api/nbEypJkH8KItw3APB3Ci2YIB6t48vW15j6qXBzpm/lights/",
   dataType: 'json',
   contentType: 'application/json',
   success: function(data, response){
     $.each(data, function(key, value){
          $("#data").append("<h3>" + key + "</h3>");
          var str = JSON.stringify(value);
          $("#data").append("<h3>" + value['name'] + "</h3>");
          $("#data").append(str);
          $("#data").append("<br><br>");
          console.log(str);
     });
   }//success
 })
});

//Dynamic Load Test
function getLights() {
  $("#getLights").empty();
    $.ajax({
         type: "GET",
         url: "http://192.168.1.107/api/nbEypJkH8KItw3APB3Ci2YIB6t48vW15j6qXBzpm/lights/",
         dataType: 'json',
         contentType: 'application/json',
         success: function(data, response){
           response = JSON.stringify(data);


           $.each(data, function(key, value){
             var checked = "";
             if(value['state']['on'] == true){
               checked="checked ";
             }
             $("#getLights").append(
               "<h1>"+key + value['name']+"</h1>" +
                `<label class="switch">`+
                  `<input id="Light`+key+`" type="checkbox"` + checked +`onchange="changeLightState(`+key+`)">` +
                  `<div class="slider"></div></label>`
              );
              console.log("Light"+key+" state ON = "+ value['state']['on']);
           });
         }//Success
      });//AJAX
  };//getLights

  //IF ELSE LIGHT SWITCH AJAX
function changeLightState(key){
  var i = key;
  console.log(i);
    if($("#Light"+i).is(":checked")) {
      console.log("checked");
      $.ajax({
        type: "PUT",
        url: "http://192.168.1.107/api/nbEypJkH8KItw3APB3Ci2YIB6t48vW15j6qXBzpm/lights/"+i+"/state",
        dataType: 'json',
        contentType: 'application/json',
        data:  JSON.stringify({"on": true}),
        success: function(data, response){
          console.log("Turning ON");
        }
      });
    }//IF
    else{
      $.ajax({
        type: "PUT",
        url: "http://192.168.1.107/api/nbEypJkH8KItw3APB3Ci2YIB6t48vW15j6qXBzpm/lights/"+i+"/state",
        dataType: 'json',
        contentType: 'application/json',
        data:  JSON.stringify({"on": false}),
        success: function(data, response){
          console.log("Somethings UP");
        }
      });
    }//Else
  }//changeLightState

   </script>
  </body>
</html>
